## Render Blueprint for NewsPulse Admin (frontend + backend)
# Docs: https://render.com/docs/blueprint-spec

services:
  - type: web
    name: newspulse-admin-panel-real
    env: static
    plan: free
    rootDir: .
    autoDeploy: true
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: NPM_CONFIG_PRODUCTION
        value: "false" # install devDependencies (vite) during build
      - key: HUSKY
        value: "0"     # disable git hooks in CI
      - key: VITE_API_URL
        sync: false     # set in Render dashboard to your backend URL

  - type: web
    name: newspulse-admin-backend
    env: node
    plan: free
    rootDir: admin-backend
    autoDeploy: true
    region: oregon
    buildCommand: npm ci --legacy-peer-deps || npm install
    startCommand: node server.mjs
    healthCheckPath: /api/system/health
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: OPENAI_API_KEY
        sync: false
      - key: MONGO_URI
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4o-mini
      - key: CLIENT_ORIGIN
        value: https://newspulse-admin-panel-real.onrender.com
      - key: ALLOWED_ORIGINS
        value: https://admin.newspulse.co.in,https://newspulse-admin-panel-real.vercel.app
      - key: SLACK_WEBHOOK_URL
        sync: false
